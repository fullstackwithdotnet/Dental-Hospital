@model DIMS.ViewModels.ReportSearchViewModel



<div class="box box-info">
    <div class="box-body">
        <div class="table-responsive">
         <div class="form-group form-group-sm dropdown">
                @Html.LabelFor(x => x.CourseId, new { @class = "control-label col-md-1" })
                <div class="col-md-2">
                    @Html.DropDownListFor(x => x.CourseId, Model.CoursesList, htmlAttributes: new { @class = "form-control", @id = "Courses" })
                    @Html.HiddenFor(X => X.CourseId)
                    @Html.ValidationMessageFor(x => x.CourseId)
                </div>
             <div class="col-md-1" id="lblDept" style="display:none">
                 @Html.LabelFor(x => x.DeptName, new { @class = "control-label" })
             </div>
             <div class="col-md-3" id="Department" style="display:none">
                 @Html.DropDownListFor(model => model.DeptId, new SelectList(Model.Departmentlist, "DeptId", "DeptName"), "Select", htmlAttributes: new { @class = "form-control " })
                 @Html.ValidationMessageFor(x => x.DeptName)
             </div>
                 @Html.LabelFor(x => x.StudentName, new { @class = "control-label col-md-1" })
                <div class="col-md-2">
                    @Html.DropDownListFor(x => x.StudentName, Model.StudentList, htmlAttributes: new { @class = "form-control", @id = "Student" })
                    @Html.ValidationMessageFor(x => x.StudentName)
                  </div>
                 <div class="col-md-1">
                     <a id="btnSearch"> <i class="fa fa-search fa fa-search btn btn-success"> Search</i></a>
                 </div>
             </div>
         </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="box box-info">
            <div class="box-header with-border">
                <h3 class="box-title">Student Wise Census Report</h3>
            </div>
            <div class="box-body">
                <div class="table-responsive">
                    <table id="tbStudentReport" class="table table-bordered table-hover" style="width:100%">
                        <thead>
                            <tr>
                                <th class="col-md-1">OP # </th>
                                <th class="col-md-1">PATIENT NAME</th>
                                <th class="col-md-1">DATE</th>
                                <th class="col-md-1">YEAR</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<link href="~/Content/buttons.dataTables.min.css" rel="stylesheet" />


@section scripts {
    <script src="~/Scripts/dataTables.buttons.min.js"></script>
    <script src="~/Scripts/buttons.flash.min.js"></script>
    <script src="~/Scripts/jszip.min.js"></script>
    <script src="~/Scripts/pdfmake.min.js"></script>
    <script src="~/Scripts/vfs_fonts.js"></script>
    <script src="~/Scripts/buttons.html5.min.js"></script>
    <script src="~/Scripts/buttons.print.min.js"></script>
    <script type="text/jscript">
        $(document).ready(function () {
            $('#btnSearch').on('click', function (e) {
                e.preventDefault();
                Searchvalue();
            });

            var Searchvalue = function () {
             $('#tbStudentReport tbody').empty();
             
             var $CourseName = $("#Courses option:selected").text();
             var $StudentName = $("#Student option:selected").text();
             var $StudentId = $("#Student").val();
               $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetStudentDetailsList", "Report")',
                   data: '{StudentId: "' + $StudentId + ' "}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        table = $('#tbStudentReport').DataTable();
                        table.destroy();
                        $('#tbStudentReport').dataTable({
                            data: data,
                            columns: [
                            { 'data': 'OpNo' },
                            { 'data': 'PatientName' },
                            { 'data': 'DisplayDate' },
                            { 'data': 'CourseYearName' },
                            ],
                            "dom": "Bfrtip",
                            "buttons": [
                                {
                                    extend:'copy',
                                    className:'copyButton',
                                    text:'<i class ="fa fa-clone"></i>Copy'

                                },
                                {
                                    extend: 'excel',
                                    text: '<i class ="fa fa-file-excel-o"></i>Excel'

                                },
                                 {
                                     extend: 'pdf',
                                     text: '<i class ="fa fa-file-pdf-o"></i>Pdf'

                                 },
                                 {
                                     extend: 'csv',
                                     text: '<i class ="fa fa-file-excel-o"></i>CSV'

                                 },
                                 {
                                     extend: 'print',
                                     messageTop: '<h3 class="text-center" style="margin-bottom:0;margin-top:0;">Student Wise Census Report</h3><br/><h4 class="text-center" style="margin-bottom:0;margin-top:0;"> Course : &nbsp ' + $CourseName + ' &nbsp Student : &nbsp  ' + $StudentName + '</h4>',
                                     customize: function ( win ) {
                                         $(win.document.body)
                                             .css( 'font-size', '10pt' )
                                             .prepend(
                                                 '<img src="~/Content/logo-fade.png" style="position:absolute; top:0; left:0;" />'
                                             );

                                         $(win.document.body).find( 'table' )
                                             .addClass( 'compact' )
                                             .css( 'font-size', 'inherit' );
                                     }
                                 }
                            ]
                        })
                    },
               })
              }
            Searchvalue();
        });


        var $Course = $("#Courses"),
      $Student = $("#Student")
        $Course.change(function () {
            var dropdowntext = $("#Courses option:selected").text();
            if (dropdowntext == "MDS") {
                $("#Department").show();
                //lblDept
                $("#lblDept").show();
            }
            else {
                $("#Department").hide();
                $("#DeptId").val(0);
                $("#lblDept").hide();

            }
            
            $Student.empty();
     $Student.append('<option value="0"> --Select --</option>');
           $.ajax({
                type: 'POST',
                url: '@Url.Action("GetStudent")',
                dataType: 'json',
                data: { id: $Course.val() },
                success: function (students) {
                    $.each(students, function (i, Student) {
                        $Student.append('<option value="' + Student.Value + '">' +
                            Student.Text + '</option>');
                    });
                },
                error: function (ex) {
                    alert('Failed to retrieve Students.' + ex);
                }
            });
            return false;
        });
      
       

        var $Dept = $("#DeptId"),
        $Student = $("#Student")

        $Dept.change(function () {
            
            $Student.empty();
            $Student.append('<option value="0"> --Select --</option>');

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetDept")', 
                dataType: 'json',
                data: { id: $Dept.val() },
                success: function (students) {
                    $.each(students, function (i, Student) {
                        $Student.append('<option value="' + Student.Value + '">' +
                            Student.Text + '</option>');
                    });
                },
                error: function (ex) {
                    alert('Failed to retrieve Departments.' + ex);
                }
            });
            return false;
        });

       

        

        

</script>
}
